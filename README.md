# Cognitive SOAR — From Prediction to Attribution

[![Lint](https://github.com/MegaJ4242/SEAS8414HW8/actions/workflows/lint.yml/badge.svg)](https://github.com/MegaJ4242/SEAS8414HW8/actions/workflows/lint.yml)

This project evolves a Mini-SOAR from binary detection into **context-aware triage**:
1) A **Classifier** decides if a URL is **MALICIOUS** or **BENIGN**.  
2) If **MALICIOUS**, a **K-Means clusterer (k=3)** attributes the sample to a likely **threat actor profile**:
   - **State-Sponsored**
   - **Organized Cybercrime**
   - **Hacktivist**

Attribution is **gated** on a malicious verdict and shown in a dedicated Streamlit tab.

---

## Tech Stack

- **Python:** 3.11 (recommended)  
- **PyCaret:** 3.3.2 (classification + clustering)  
- **scikit-learn:** 1.4.2  
- **pandas:** 2.1.4  
- **Streamlit:** 1.38.0

> Pinned in `requirements.txt` for reproducibility.

---

## Repository Structure

├── app.py # Streamlit UI (Classifier + Threat Attribution tabs)
├── train_model.py # Data synthesis + classifier + k-means training + plots
├── requirements.txt
├── Dockerfile
├── docker-compose.yml
├── Makefile
├── README.md
├── INSTALL.md
├── TESTING.md
├── .flake8 # Lint rules (with targeted per-file ignores)
├── .github/workflows/lint.yml # GitHub Actions (flake8)
├── data/ # Generated by training (train.csv)
├── models/ # Generated by training (pkl + mapping json)
└── reports/ # Generated plots (confusion_matrix, AUC, PR, elbow, silhouette, cluster, feature)

---

## Quickstart (Windows, Git Bash)

```bash
cd "/c/Users/mthomas/Desktop/cognitive-soar"

# Python 3.11 virtualenv
py -3.11 -m venv .venv || python -m venv .venv
source .venv/Scripts/activate

# Install deps with pins compatible with PyCaret 3.3.2
python -m pip install --upgrade pip setuptools wheel
pip install --no-cache-dir -r requirements.txt

# Train models + generate plots (reports/)
python -u train_model.py

# Launch UI
python -m streamlit run app.py

## How it Works
- Synthetic Threat Profiles

train_model.py generates logical, separable patterns:

   State-Sponsored: valid SSL, longer-lived domains, subtle deception, fewer redirects.

   Organized Cybercrime: URL shorteners, IP hosts, abnormal structure, many redirects.

   Hacktivist: political keywords, mixed hygiene, opportunistic patterns.

- Dual-Model Workflow

   Classifier (PyCaret classification) trains on features + label.

   Clusterer (PyCaret k-means, k=3) trains on malicious-only rows.

A lightweight centroid heuristic maps Cluster {0,1,2} → {State-Sponsored, Organized Cybercrime, Hacktivist} and saves it to models/cluster_profile_map.json.

UI Flow

User enters features (or uses presets) → classifier predicts.

If MALICIOUS, the same features are fed to the clusterer → Threat Attribution tab displays the mapped actor profile.
Testing

Manual cases are in TESTING.md. Use sidebar presets for quick verification:

Benign

Organized Cybercrime (malicious)

State-Sponsored (malicious)

Hacktivist (malicious)
CI / Lint

GitHub Actions runs flake8 on each push/PR (.github/workflows/lint.yml).

Local check:

python -m pip install flake8
flake8 .


.flake8 sets max-line-length = 120 and applies a few per-file ignores (for long UI strings and helper scripts).
Troubleshooting

“Clustering model or mapping not found…”
Ensure both exist:
models/threat_actor_profiler.pkl and models/cluster_profile_map.json.
Re-train: python -u train_model.py. If JSON is still missing, regenerate via scripts/generate_cluster_map.py (or re-train).

KeyError: "['actor_profile'] not in index"
You previously trained the classifier with actor_profile present. This repo trains on features + label only; re-train with python -u train_model.py. The UI also includes a small back-compat shim.

ValueError: invalid literal for int() with base 10: 'Cluster 1'
The app now robustly parses labels like "Cluster 1"; ensure you’re using the current app.py.

Dependency conflicts (pandas/scikit-learn/joblib)
Use the pinned requirements.txt. If problems persist:

pip cache purge
pip install --no-cache-dir -r requirements.txt


Windows build errors for SHAP/C++
Wheels are pulled for the pinned versions. If you still see build errors, install the MSVC build tools or use the exact pins provided here.
